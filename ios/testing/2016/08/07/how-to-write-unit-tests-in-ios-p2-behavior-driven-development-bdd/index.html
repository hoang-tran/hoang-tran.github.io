<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>How to write unit tests in iOS Part 2: Behavior-driven Development (BDD) &#8211; Hoang Tran</title>
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdn.mathjax.org">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="
	Learn how to write elegant unit tests in iOS using Behavior-driven Development (BDD)
">
    <meta name="robots" content="all">
    <meta name="author" content="">
    <meta name="keywords" content="ios, testing">
    <link rel="canonical" href="http://hoangtran.me/ios/testing/2016/08/07/how-to-write-unit-tests-in-ios-p2-behavior-driven-development-bdd/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Hoang Tran" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?202008151440" type="text/css">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
    
      <script src="https://use.fontawesome.com/2982768df5.js"></script>
    

    <!-- MathJax -->
    

    <!-- Verifications -->
    
      <meta name="google-site-verification" content="rXDWxoQCkROwuzF0Ie1e_pN7zjBJjOx9ZIcdnMF7HmM" />
    
    
      <meta name="msvalidate.01" content="78D007F72A205107B4315B6F41D46C0F" />
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="How to write unit tests in iOS Part 2: Behavior-driven Development (BDD)">
    <meta property="og:description" content="
	Learn how to write elegant unit tests in iOS using Behavior-driven Development (BDD)
">
    <meta property="og:url" content="http://hoangtran.me/ios/testing/2016/08/07/how-to-write-unit-tests-in-ios-p2-behavior-driven-development-bdd/
">
    <meta property="og:site_name" content="Hoang Tran">
    <meta property="og:image" content="">
    <meta property="fb:app_id" content="1001202813330058" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    
        <meta name="twitter:site" content="@_hoangtran" />
    
    <meta name="twitter:title" content="How to write unit tests in iOS Part 2: Behavior-driven Development (BDD)" />
    <meta name="twitter:description" content="
	Learn how to write elegant unit tests in iOS using Behavior-driven Development (BDD)
" />
    <meta name="twitter:url" content="http://hoangtran.me/ios/testing/2016/08/07/how-to-write-unit-tests-in-ios-p2-behavior-driven-development-bdd/
" />
    <meta name="twitter:image" content="" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icon/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/icon/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icon/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icon/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icon/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icon/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/images/icon/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/images/icon/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/images/icon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/images/icon/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/images/icon/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-81196779-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site">
  
  
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	  if (d.getElementById(id)) return;
	  js = d.createElement(s); js.id = id;
	  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2&appId=1001202813330058&autoLogAppEvents=1";
	  fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>


  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://hoangtran.me/" class="site-title">Hoang Tran</a>
      <nav class="site-nav">
        <!-- <a href="http://hoangtran.me/">Home</a>
<a href="http://hoangtran.me/blog">Blog</a>
 -->
      </nav>
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        <div class="post-header mb2">
  <h1>How to write unit tests in iOS Part 2: Behavior-driven Development (BDD)</h1>
  <span class="post-meta">
07 August 2016
  
</div>

<article class="post-content">
  <p>In <a href="/ios/testing/2016/07/31/how-to-write-unit-tests-in-ios-p1-xctestcase">part 1</a>, we discovered the basic usage of <code class="language-plaintext highlighter-rouge">XCTestCase</code> and wrote some simple unit tests for the Gun class using Swift. For a quick recap, this is what we got so far:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">MyNativeTests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>

  <span class="kd">func</span> <span class="nf">testGunCanShootIfItHasBullets</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">gun</span><span class="o">.</span><span class="nf">shoot</span><span class="p">()</span>
    <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">bullets</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"expect Gun to be out of bullet"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">testGunCannotShootIfItHasNoBullet</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">gun</span><span class="o">.</span><span class="nf">shoot</span><span class="p">()</span>
    <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">bullets</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"expect the number of bullets to remain the same"</span><span class="p">)</span>
  <span class="p">}</span>

<span class="p">}</span></code></pre></figure>

<p>As you can see, each case in the method has its own unit test. They are arranged with this structure:</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">test method A case 1
test method A case 2
test method B
test method C case 1
test method C case 2 sub-case 1
test method C case 2 sub-case 2
...</code></pre></figure>

<p>This is the traditional way of writing unit tests in which you list out all the test cases linearly. Each test case is separated and does not relate to each other.</p>

<p>Many projects still prefer this approach because it’s very simple and straightforward.</p>

<h2 id="but-is-that-the-best-we-can-do">But is that the best we can do?</h2>

<p>Let’s look back at our example and further develop it. Currently we have 2 cases for the <code class="language-plaintext highlighter-rouge">shoot</code> method. (in pseudo code)</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">test Gun can shoot if it has bullets
test Gun cannot shoot if it has no bullet</code></pre></figure>

<p>Let’s make it a little bit more complicated. Our Gun now can only shoot if it is <code class="language-plaintext highlighter-rouge">unlocked</code>. That would require some changes in the test cases like so:</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">test Gun can shoot if it has bullets and it is unlocked
test Gun cannnot shoot if it has bullets but it is locked
test Gun cannot shoot if it has no bullet</code></pre></figure>

<p>And we need another 2 methods for locking/unlocking the Gun:</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">test Gun can shoot if it has bullets and it is unlocked
test Gun cannnot shoot if it has bullets but it is locked
test Gun cannot shoot if it has no bullet
test Gun lock will make it locked
test Gun unlock will make it unlocked</code></pre></figure>

<p>Now when we look at it, we see a line-by-line list with various conditions and scenarios. It’s easy to get lost.</p>

<p>You can’t tell what the Gun does just by taking a quick glance anymore. You have to stop and read each line carefully, which is not very ideal.</p>

<p>Wouldn’t it be great if we could group all the common parts among test cases?</p>

<p>Actually there is such way. It’s called <code class="language-plaintext highlighter-rouge">Behavior-driven Development</code>, or <code class="language-plaintext highlighter-rouge">BDD</code> for short.</p>

<p>The idea is: you describe how your class would <strong>behave</strong> from the top down to the bottom. You describe the <code class="language-plaintext highlighter-rouge">big picture</code> first, then go down to the nitty gritty.</p>

<p>Here is the <code class="language-plaintext highlighter-rouge">BDD</code> structure:</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">describe class Y
  describe method A
    case 1
    case 2

  describe method B

  describe method C
    case 1
    case 2
      sub-case 1
      sub-case 2
  ...</code></pre></figure>

<p>As you can see, there is no duplicated parts anymore. Tests are grouped by methods and cases. You can easily skim and still get the whole picture about what the class can do.</p>

<h2 id="lets-try-it-with-our-gun-example">Let’s try it with our Gun example</h2>

<p>We will go from the very top (<code class="language-plaintext highlighter-rouge">class</code>) and down one level at a time.</p>

<p>First, we describe a Gun.</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">describe a Gun</code></pre></figure>

<p>A Gun has 3 methods: <code class="language-plaintext highlighter-rouge">shoot</code>, <code class="language-plaintext highlighter-rouge">lock</code> and <code class="language-plaintext highlighter-rouge">unlock</code>.</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">describe a Gun
  describe shoot
  describe lock
  describe unlock</code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">shoot</code> method has 2 cases: <code class="language-plaintext highlighter-rouge">has bullets</code> and <code class="language-plaintext highlighter-rouge">has no bullet</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">lock</code> and <code class="language-plaintext highlighter-rouge">unlock</code> methods each only has one case.</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">describe a Gun
  describe shoot
    when has bullets
    when has no bullet

  describe lock
  describe unlock</code></pre></figure>

<p>In the <code class="language-plaintext highlighter-rouge">has bullets</code> case of the <code class="language-plaintext highlighter-rouge">shoot</code> method, we have 2 sub-cases: <code class="language-plaintext highlighter-rouge">is unlocked</code> and <code class="language-plaintext highlighter-rouge">is locked</code>.</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">describe a Gun
  describe shoot
    when has bullets
      when is unlocked
      when is locked

    when has no bullet

  describe lock
  describe unlock</code></pre></figure>

<p>And each case will have different behavior.</p>

<figure class="highlight"><pre><code class="language-abc" data-lang="abc">describe a Gun
  describe shoot
    when has bullets
      when is unlocked
        it can shoot

      when is locked
        it cannot shoot

    when has no bullet
      it cannot shoot

  describe lock
   it locks the Gun

  describe unlock
   it unlocks the Gun</code></pre></figure>

<p>Again, from looking at this description, you quickly understand what a Gun can do in various cases. This saves you a lot of time and headache when reading tests.</p>

<h2 id="translating-into-swift">Translating into Swift</h2>

<p>First, follow this <a href="/ios/testing/2016/07/24/how-to-setup-testing-for-new-ios-project/#step-3-setup-unit-tests">guide</a> (from step 1 to step 3) to setup <code class="language-plaintext highlighter-rouge">cocoapods</code> and add the <a href="https://github.com/Quick/Quick">Quick</a> pod.</p>

<p>Add a new file called <code class="language-plaintext highlighter-rouge">GunSpec.swift</code> to your test target. Notice that unit tests written using <code class="language-plaintext highlighter-rouge">BDD</code> style should have the suffix <code class="language-plaintext highlighter-rouge">Spec</code> instead of <code class="language-plaintext highlighter-rouge">Tests</code> as the naming convention.</p>

<p>Your <code class="language-plaintext highlighter-rouge">GunSpec</code> class must subclass from <code class="language-plaintext highlighter-rouge">QuickSpec</code> and override the <code class="language-plaintext highlighter-rouge">spec</code> method.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Quick</span>

<span class="kd">class</span> <span class="kt">GunSpec</span> <span class="p">:</span> <span class="kt">QuickSpec</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">spec</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Now we’re going to describe the Gun’s behaviors again. But this time, we do it with Swift.</p>

<p>First, we describe a Gun.</p>

<p>(Actually the line <code class="language-plaintext highlighter-rouge">class GunSpec : QuickSpec</code> already tells this. We don’t need to write any more code)</p>

<p>A Gun has 3 methods: <code class="language-plaintext highlighter-rouge">shoot</code>, <code class="language-plaintext highlighter-rouge">lock</code> and <code class="language-plaintext highlighter-rouge">unlock</code>.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">override</span> <span class="kd">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">super</span><span class="o">.</span><span class="nf">spec</span><span class="p">()</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"lock"</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"unlock"</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">shoot</code> method has 2 cases: <code class="language-plaintext highlighter-rouge">has bullets</code> and <code class="language-plaintext highlighter-rouge">has no bullet</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">lock</code> and <code class="language-plaintext highlighter-rouge">unlock</code> methods each only has one case. (Note that when translate to Swift code, we don’t use the word <code class="language-plaintext highlighter-rouge">when</code>. We use <code class="language-plaintext highlighter-rouge">context</code> instead)</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">override</span> <span class="kd">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">super</span><span class="o">.</span><span class="nf">spec</span><span class="p">()</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">context</span><span class="p">(</span><span class="s">"has bullets"</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="nf">context</span><span class="p">(</span><span class="s">"has no bullet"</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"lock"</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"unlock"</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>In the context <code class="language-plaintext highlighter-rouge">has bullets</code> of the <code class="language-plaintext highlighter-rouge">shoot</code> method, we have 2 sub-cases: <code class="language-plaintext highlighter-rouge">is unlocked</code> and <code class="language-plaintext highlighter-rouge">is locked</code></p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">override</span> <span class="kd">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">super</span><span class="o">.</span><span class="nf">spec</span><span class="p">()</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">context</span><span class="p">(</span><span class="s">"has bullets"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">context</span><span class="p">(</span><span class="s">"is unlocked"</span><span class="p">)</span> <span class="p">{</span>

      <span class="p">}</span>

      <span class="nf">context</span><span class="p">(</span><span class="s">"is locked"</span><span class="p">)</span> <span class="p">{</span>

      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">context</span><span class="p">(</span><span class="s">"has no bullets"</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"lock"</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"unlock"</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And each case will have different behavior.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">override</span> <span class="kd">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">super</span><span class="o">.</span><span class="nf">spec</span><span class="p">()</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">context</span><span class="p">(</span><span class="s">"has bullets"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">context</span><span class="p">(</span><span class="s">"is unlocked"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">it</span><span class="p">(</span><span class="s">"can shoot"</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nf">context</span><span class="p">(</span><span class="s">"is locked"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">it</span><span class="p">(</span><span class="s">"cannot shoot"</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">context</span><span class="p">(</span><span class="s">"has no bullet"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">it</span><span class="p">(</span><span class="s">"cannot shoot"</span><span class="p">)</span> <span class="p">{</span>

      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"lock"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">it</span><span class="p">(</span><span class="s">"locks the Gun"</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nf">describe</span><span class="p">(</span><span class="s">"unlock"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">it</span><span class="p">(</span><span class="s">"unlocks the Gun"</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>At this point, we are done describing the Gun with all funtionalities. It’s time to write unit tests for each case. Let’s start with the first one.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">//...</span>
<span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">context</span><span class="p">(</span><span class="s">"has bullets"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">context</span><span class="p">(</span><span class="s">"is unlocked"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">it</span><span class="p">(</span><span class="s">"can shoot"</span><span class="p">)</span> <span class="p">{</span>

      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//...</span></code></pre></figure>

<p>We’re going to write the 3 steps for this test just like we did in the previous post, which are: <code class="language-plaintext highlighter-rouge">setup</code>, <code class="language-plaintext highlighter-rouge">execution</code> and <code class="language-plaintext highlighter-rouge">expectation</code></p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">//...</span>
<span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">context</span><span class="p">(</span><span class="s">"has bullets"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">context</span><span class="p">(</span><span class="s">"is unlocked"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">it</span><span class="p">(</span><span class="s">"can shoot"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 1. Setup: create a gun with 1 bullet</span>
        <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">// make sure it is unlocked</span>
        <span class="n">gun</span><span class="o">.</span><span class="n">isLocked</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="c1">// 2. Execution: call the shoot method</span>
        <span class="n">gun</span><span class="o">.</span><span class="nf">shoot</span><span class="p">()</span>
        <span class="c1">// 3. Expectation: expect the gun to be out of bullet</span>
        <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">bullets</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"expect Gun to be out of bullet"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//...</span></code></pre></figure>

<p>Now when we run the test (⌘ + U), it will fail because we don’t have the property <code class="language-plaintext highlighter-rouge">isLocked</code> in the Gun class yet. Open your <code class="language-plaintext highlighter-rouge">Gun.swift</code> file and add this:</p>

<p>(If you forget where the <code class="language-plaintext highlighter-rouge">Gun.swift</code> is, please read <a href="/ios/testing/2016/07/31/how-to-write-unit-tests-in-ios-p1-xctestcase">part 1</a> again)</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">Gun</span> <span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>

  <span class="k">var</span> <span class="nv">bullets</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1">// add isLocked property here</span>
  <span class="k">var</span> <span class="nv">isLocked</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="c1">//...</span>
<span class="p">}</span></code></pre></figure>

<p>Run the test again. This time it should pass.</p>

<p>Let’s move on to the next case. This is the case where the Gun has bullets but it is locked and cannot shoot. Therefore, we expect the number of bullets to remain the same.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">//...</span>
<span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">context</span><span class="p">(</span><span class="s">"has bullets"</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//...</span>

    <span class="nf">context</span><span class="p">(</span><span class="s">"is locked"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">it</span><span class="p">(</span><span class="s">"cannot shoot"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">// the gun is locked</span>
        <span class="n">gun</span><span class="o">.</span><span class="n">isLocked</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="n">gun</span><span class="o">.</span><span class="nf">shoot</span><span class="p">()</span>
        <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">bullets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"expect Gun to not shoot anything"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//...</span></code></pre></figure>

<p>This test will fail. We haven’t implemented anything related to the <code class="language-plaintext highlighter-rouge">isLocked</code> logic in the Gun class yet. We will do it now:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">Gun</span> <span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
  <span class="c1">//...</span>

  <span class="kd">func</span> <span class="nf">shoot</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">bullets</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
      <span class="k">if</span> <span class="o">!</span><span class="n">isLocked</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">bullets</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">//...</span>
<span class="p">}</span></code></pre></figure>

<p>Rerun the tests to make sure they all pass.</p>

<p>Now if we continue down the road with the remaining cases, we will have the full <code class="language-plaintext highlighter-rouge">Spec</code> for the Gun:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">GunSpec</span> <span class="p">:</span> <span class="kt">QuickSpec</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">func</span> <span class="nf">spec</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">spec</span><span class="p">()</span>

    <span class="nf">describe</span><span class="p">(</span><span class="s">"shoot"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">context</span><span class="p">(</span><span class="s">"has bullets"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">context</span><span class="p">(</span><span class="s">"is unlocked"</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">it</span><span class="p">(</span><span class="s">"can shoot"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">gun</span><span class="o">.</span><span class="n">isLocked</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="n">gun</span><span class="o">.</span><span class="nf">shoot</span><span class="p">()</span>
            <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">bullets</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"expect Gun to be out of bullet"</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="nf">context</span><span class="p">(</span><span class="s">"is locked"</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">it</span><span class="p">(</span><span class="s">"cannot shoot"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">gun</span><span class="o">.</span><span class="n">isLocked</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="n">gun</span><span class="o">.</span><span class="nf">shoot</span><span class="p">()</span>
            <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">bullets</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"expect Gun to not shoot anything"</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nf">context</span><span class="p">(</span><span class="s">"has no bullet"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">it</span><span class="p">(</span><span class="s">"cannot shoot"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">gun</span><span class="o">.</span><span class="nf">shoot</span><span class="p">()</span>
            <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">bullets</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"expect Gun to not shoot anything"</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">describe</span><span class="p">(</span><span class="s">"lock"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">it</span><span class="p">(</span><span class="s">"locks the Gun"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">gun</span><span class="o">.</span><span class="nf">lock</span><span class="p">()</span>
        <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">isLocked</span><span class="p">,</span> <span class="s">"expect Gun to be locked"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">describe</span><span class="p">(</span><span class="s">"unlock"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">it</span><span class="p">(</span><span class="s">"unlocks the Gun"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">gun</span> <span class="o">=</span> <span class="kt">Gun</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">gun</span><span class="o">.</span><span class="nf">unlock</span><span class="p">()</span>
        <span class="c1">// notice that we use assert False here</span>
        <span class="kt">XCTAssertFalse</span><span class="p">(</span><span class="n">gun</span><span class="o">.</span><span class="n">isLocked</span><span class="p">,</span> <span class="s">"expect Gun to be unlocked"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And the full Gun class with 2 additional methods: <code class="language-plaintext highlighter-rouge">lock</code> and <code class="language-plaintext highlighter-rouge">unlock</code>.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">Gun</span> <span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>

  <span class="k">var</span> <span class="nv">bullets</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">var</span> <span class="nv">isLocked</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="nf">init</span><span class="p">(</span><span class="nv">bullets</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">bullets</span> <span class="o">=</span> <span class="n">bullets</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">shoot</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">bullets</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
      <span class="k">if</span> <span class="o">!</span><span class="n">isLocked</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">bullets</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">lock</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">isLocked</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">unlock</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">isLocked</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Although there is still some duplicated code in <code class="language-plaintext highlighter-rouge">GunSpec.swift</code>, you can refactor it out pretty easily using the <code class="language-plaintext highlighter-rouge">beforeEach</code> block as stated in <a href="https://github.com/Quick/Quick/blob/master/Documentation/en-us/QuickExamplesAndGroups.md#sharing-setupteardown-code-using-beforeeach-and-aftereach">Quick’s documentation</a>.</p>

<p>The important thing is you know the <strong>flow</strong>. You know how to do things the <code class="language-plaintext highlighter-rouge">BDD</code> way.</p>

<h2 id="wrap-up">Wrap up</h2>

<p>Today we discussed about the problem with traditional way of writing unit tests where we list things out linearly. We then introduced the <code class="language-plaintext highlighter-rouge">BDD</code> approach of designing tests from the top down so that it’s easier to read and navigate through cases.</p>

<p>Now I don’t say that you should dump the traditional way and only stick with <code class="language-plaintext highlighter-rouge">BDD</code>. If you’re just starting out, learn how to write a correct unit test first. Organizing your tests comes later.</p>

<p>The idea is that you get to know what options are available and which one to choose for your next project.</p>

<p>In the next article, I’ll be talking about <code class="language-plaintext highlighter-rouge">Test-driven Development</code> and how we can apply it to build a <code class="language-plaintext highlighter-rouge">Calculator</code> class from the ground up.</p>

<p>Stay tuned.</p>

</article>




<div class="fb-like" data-href="http://hoangtran.me/ios/testing/2016/08/07/how-to-write-unit-tests-in-ios-p2-behavior-driven-development-bdd/
" data-width="320" data-layout="standard" data-action="like" data-size="large" data-show-faces="true" data-share="true"></div>

	<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://hoangtran.us1.list-manage.com/subscribe/post?u=5365241c266315ff943db64c7&amp;id=0a26c79af4" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<h2>Subscribe to my blog</h2>
	<p>If you think this blog is useful, please subscribe to get notifications on my new posts.</p>
<div class="mc-field-group">
	<label for="mce-FNAME">Name </label>
	<input type="text" value="" name="FNAME" class="" id="mce-FNAME">
</div>
<div class="mc-field-group">
	<label for="mce-EMAIL">Email Address </label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_5365241c266315ff943db64c7_0a26c79af4" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[1]='FNAME';ftypes[1]='text';fnames[0]='EMAIL';ftypes[0]='email';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->



  <div class="fb-comments" data-href="http://hoangtran.me/ios/testing/2016/08/07/how-to-write-unit-tests-in-ios-p2-behavior-driven-development-bdd/
" data-width="100%" data-numposts="10"></div>



  <h3 class="related-post-title">Related posts</h3>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
        <a href="/ios/testing/2016/08/09/write-better-unit-test-assertion-with-nimble/" class="post-link">
          <h4 class="post-title">Write better unit test assertions with Nimble</h4>
        </a>
      
    </div>
  
    <div class="post ml2">
      
    </div>
  
    <div class="post ml2">
      
        <a href="/ios/testing/2016/07/31/how-to-write-unit-tests-in-ios-p1-xctestcase/" class="post-link">
          <h4 class="post-title">How to write unit tests in iOS Part 1: XCTestCase</h4>
        </a>
      
    </div>
  
    <div class="post ml2">
      
        <a href="/ios/testing/2016/07/24/how-to-setup-testing-for-new-ios-project/" class="post-link">
          <h4 class="post-title">How to setup testing for new iOS project</h4>
        </a>
      
    </div>
  


      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    
      <div class="social-icons">
  <!--  -->
  <!-- <a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/1608859"></a> -->
  <!--  -->
  <!-- 
  <a class="fa fa-facebook" href="https://www.facebook.com/hoangtx.master"></a>
   -->
  <!-- 
  <a class="fa fa-github" href="https://github.com/hoang-tran"></a>
   -->
  <!--  -->
  
  <a class="fa fa-linkedin" href="https://www.linkedin.com/in/hoangxtran"></a>
  
  
  <a class="fa fa-twitter" href="https://twitter.com/_hoangtran"></a>
  
  
  <a class="fa fa-envelope" href="mailto:hoang@hoangtran.me"></a>
  
  <!--  -->
  <!--  -->
  <!--  -->
  <!--  -->
  <!--  -->
  <!-- <a class="fa fa-rss" href="/feed.xml"></a> -->
  <!-- <div class="right">
    
    
    
  </div> -->
</div>
<div class="clearfix"></div>

    
  </div>
</footer>


</body>
</html>
